<base href="/">
<title>XElement Performance</title>
<script>document.querySelector('base').href = location.pathname.startsWith('/element') ? '/element/performance/' : '/';</script>
<link rel="stylesheet" href="./index.css">

<h1>XElement Performance</h1>

<o-loop>
    <template shadowroot="open">
        <span text="{{count.toLocaleString()}}"></span>
        <slot></slot>
    </template>

    <br>
    <div>{{radioShared}}</div>
    <input type="radio" name="radio" checked="{{ radioShared === radioOne }}" oninput="{{ radioShared = 'one' }}" />
    <input type="radio" name="radio" checked="{{ radioShared === radioTwo }}" oninput="{{ radioShared = 'two' }}" />
    <br>

    <br>
    <input type="checkbox" value="{{count}}" checked="{{ count }}" />
    <input type="checkbox" value="{{checked}}" checked="{{ checked }}" oninput="{{ checked = this.checked }}" />
    <br>

    <br>
    <div>{{number}}</div>
    <select value="{{number}}" oninput="{{number=JSON.parse(this.value)}}">
        <option value="{{0}}">zero</option>
        <option value="{{1}}">one</option>
        <option value="{{2}}">two</option>
    </select>
    <div>{{boolean}}</div>
    <select value="{{boolean}}" oninput="{{boolean=JSON.parse(this.value)}}">
        <option value="{{true}}">yes</option>
        <option value="{{false}}">no</option>
    </select>
    <div>{{string}}</div>
    <select value="{{string}}" oninput="{{string=this.value}}">
        <option value="{{'foo'}}">foo</option>
        <option value="{{'bar'}}">bar</option>
    </select>
    <br>

    <br>
    <div>{{date?.toLocaleString()}}</div>
    <input value="{{date}}" oninput="{{console.log(date = this.valueAsNumber)}}" type="date" />
    <div>{{time?.toLocaleString()}}</div>
    <input value="{{time}}" oninput="{{time = this.valueAsNumber}}" type="time" />
    <div>{{datetime}}</div>
    <input x-value="datetime" x-oninput="datetime = this.valueAsNumber" type="datetime-local" />
    <br>

    <h3>{{count.toLocaleString()}}</h3>
    <input value="{{count}}" oninput="{{count = this.valueAsNumber}}" type="number" />

    <br>

    <button onclick="{{push()}}">push</button>
    <button onclick="{{overwrite()}}">overwrite</button>
    <button onclick="{{raw()}}">raw</button>
    <button onclick="{{clear()}}">clear</button>

    <div id="raw"></div>

    <div each="{{[items,'item']}}">
        <div class="box">{{item}}</div>
    </div>
</o-loop>

<script type="module">
    import XElement from '../x-element.js';

    class OLoop extends XElement {

        time = Date.now();
        date = Date.now();
        datetime = Date.now();

        number = 1;
        boolean = true;
        string = 'foo';

        checked = false;
        radioShared = '';
        radioOne = 'one';
        radioTwo = 'two';

        item = undefined;
        items = [];
        message = '';
        count = 100000;

        constructor() {
            super();
            this.number = 1;
            // this.shadowRoot.innerHTML = `<slot></slot>`;
            // this.innerHTML = `<div style="{{'background:blue'}}">Blue</div>`
        }

        raw() {
            console.time('raw');
            const template = document.createElement('template');
            let html = '';
            const count = this.count;
            for (var i = 0; i < count; i++) html += `<div class="box"><div>${i}</div></div>`;
            template.innerHTML = html;
            raw.appendChild(template.content);
            console.timeEnd('raw');
        }
        push() {
            console.time('push');
            for (var i = 0; i < this.count; i++) this.items.push(i);
            console.timeEnd('push');
        }
        overwrite() {
            console.time('overwrite');
            var items = [];
            for (var i = 0; i < this.count; i++) items.push(i);
            this.items = items;
            console.timeEnd('overwrite');
        }
        clear() {
            this.items = [];
        }
        // async connected() {
        //     // console.log('conn')
        // }
        async connectedCallback() {
            // console.log('before connectedCallback');
            await super.connectedCallback();
            // console.log('after connectedCallback');
        }
    }

    OLoop.define();


</script>