<style>
    :not(:defined) {
        visibility: hidden;
    }

    html>* {
        margin: 0;
        padding: 0;
        text-align: center;
    }

    body,
    o-loop {
        width: 100%;
        height: 3000px;
        display: block;
    }

    .box {
        width: 60px;
        margin: 1px;
        font-size: 12px;
        text-align: center;
        display: inline-block;
        background: lightgray;
    }

    .box input {
        width: 90%;
        margin: auto;
        display: block;
    }

    .wrap {
        overflow: hidden;
    }
</style>

<main></main>

<script type="module">
    import { XElement } from './virtual.js';

    const context = () => ({
        count: 0,
        list: [],
        message: 'hello world',
        overwrite() {
            this.list = this.list.length ? [] : Array.from({ length: 10_000 }, (v, i) => i);
        },
        increment() {
            this.count++;
        }
    });

    const template = (
        { message, count, list, increment, overwrite },
        { h1, div, br, button }
    ) => [
            h1({ style: 'background:red' }, message),
            div(`Count: ${count}`),
            button({ onclick: increment }, 'Increment Count'),
            button({ onclick: overwrite }, 'Overwrite List'),
            div(...list.map(i => div({ class: 'box' }, `${i}`)))
        ];

    // const root = () => document.querySelector('main')
    // const virtual = new Virtual(root, context, template);
    // virtual.render();

    class XE extends XElement {

        static context = context;
        static template = template;
        static options = { root: 'this', slot: 'default' };

        // static options = { shadow: true, }
        // static root() { return this; }
        // static root() { return this.shadowRoot; }

        // constructor() {
        //     super();
        //     this.shadowRoot.appendChild(document.createElement('slot'));
        // }

    }

    document.querySelector('main').appendChild(document.createElement('x-e'));
    customElements.define('x-e', XE);


    // const Primitive = function (value) {
    //     function Primitive(data) {
    //         return data === undefined ? value : value = data;
    //     }
    //     Primitive[Symbol.toPrimitive] = function () { return value; }
    //     // Primitive[Symbol.toStringTag] = function () { return 'Validator'; }
    //     Primitive[Symbol.hasInstance] = function (instance) {
    //         console.log(instance);
    //         return value instanceof instance;
    //     }
    //     return Primitive
    // }

    // let o = new Proxy({
    //     count: Primitive(10),
    //     string: Primitive('hello')
    // }, {
    //     construct(...args) {
    //         console.log(args)
    //         return Reflect.construct(...args);
    //     },
    //     get(target, key, receiver) {
    //         console.log('get', key)
    //         return Reflect.get(target, key, receiver);
    //     },
    //     set(target, key, value, receiver) {
    //         console.log('set', key)
    //         return Reflect.set(target, key, value, receiver);
    //     },
    //     apply(...args) {
    //         console.log(args);
    //         return Reflect.apply(...args);
    //     }
    // });

    // let { count, string } = o;

    // console.log(count());
    // console.log(count++)
    // console.log(count);
    // console.log(typeof count);
    // console.log(count instanceof Number)
    // console.log(Object.prototype.toString.call(count));

    // console.log(string());
    // console.log(string += ' world');
    // console.log(string);
    // console.log(typeof string);
    // console.log(string instanceof String)
    // console.log(Object.prototype.toString.call(string));

</script>