<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
<script type="module">

let html = function (strings, ...v1) {
    const l = v1.length;
    // v1[0].baz = 'boo';
    // console.log(this)
    // console.log(v1);
    return function (...v2) {
        console.log(this, v1)
        return strings.map((s, i) => `${s}${i < l ? `{{${i}}}` : ''}`).join('');
    };
};

// class E {
//     constructor(c,h) {
//     }
// }

// const e = new Proxy(
//   Reflect.construct.bind(null, E),
//   {
//     get(tar, prop, val) {
//       return Reflect.get(E, prop, val);
//     },
//     set(tar, prop, val) {
//       return Reflect.set(E, prop, val);
//     },
//     apply(target, self, args) {
//       return target({...args, length: args.length});
//     }
//   }
// );

const XC = new Proxy(
    class E extends HTMLElement {
        foo = 'bar';

        // connectedCallback() {
        //     this.foo = 'baz';
        //     console.log(this.foo);
        // }
    },
    {
    // get(t,n,v) {
    //     // console.log(n,v);
    //     return Reflect.get(t,n,v);
    // },
    // set(t,n,v) {
    //     console.log(n,v);
    //     return Reflect.set(t,n,v);
    // },
    construct(target,args,extender){
        const instance = Reflect.construct(target, args, extender);
        console.log(instance.foo);
        return instance;
        // return new Proxy(instance, {
        //     set(t,n,v) {
        //         console.log(n,v);
        //         return Reflect.set(t,n,v);
        //     },
        // });

        // constructor = new Proxy(constructor, {
        //     construct(target, args, extender) {
        //         const instance = Reflect.construct(target, args, extender);
        //         instance[upgrade]();
        //         return instance;
        //     },
        // });
    },
    // apply(target, self, args) {
    //     console.log(target, self)
    //     return target({...args, length: args.length});
    // }
  }
);





// const m = e({ foo: 'bar' }, c => html`
//     <h1>${c} ${c}</h1>
// `);

// console.log(m);

// class XC extends HTMLElement {

//     #foo='bar';
//     get foo (){
//         return this.#foo;
//     }
//     template = () => html`<h1>${this.foo}</h1>`;

//     constructor() {
//         super();
//         // const shadow = this.attachShadow({ mode: 'open' });
//         // const slot = document.createElement('slot');
//         // shadow.appendChild(slot);
//         // slot.innerHTML = 'constructor';
//         // shadow.innerHTML = this.template();
//     }
//     connectedCallback() {
//         this.innerHTML = this.template();
//         setTimeout(()=>{
//         this.#foo = 'baz';
//         this.innerHTML = this.template();
//         // this.shadowRoot.innerHTML = this.template();
//         },2000)
//         // this.append('connected');
//     }
// }

customElements.define('x-c', XC);
const xc = document.createElement('x-c');
// console.log(xc.outerHTML, xc.shadowRoot.innerHTML);
// xc.append('created')
document.body.append(xc);

// console.log(xc.outerHTML, xc.shadowRoot.innerHTML);

// console.log(document.createElement('x-c').shadowRoot.innerHTML);

// const module = ((c) => html`
//     <section>
//         ${c.foo}
//         <h1>404</h1>
//         <h2>Page Not Found</h2>
//     </section>
// `)({
//     foo: 'bar'
// });
// console.log(module());

// const ctx = {
//     foo: 'bar'
// };

// let html = function (strings, ...v1) {
//     const l = v1.length;
//     return function (...v2) {
//         console.log(v1, v2);
//         return strings.map((s, i) => `${s}${i < l ? `{{${i}}}` : ''}`).join('');
//     };
// };

// const m = ((c, a, b) => html`
//     <section>
//         ${a} ${b} ${c.foo}
//         <h1>404</h1>
//         <h2>Page Not Found</h2>
//     </section>
// `)({
//     foo: 'bar'
// });

// let wraped = function (c) {
//     return html.bind();
// };

// console.log(m('a', 'b'));

</script>
</body>
</html>